<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:a="http://xmlns.jcp.org/jsf/passthrough" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
  <title>CoffeeGram</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="resources/stylesheets/app.css" />
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
  </script>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="resources/js/stats.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    var avgPriceChartData;
    $.post('avgpricechart', (res) => {
      avgPriceChartData = JSON.parse(res);
      google.charts.load('current', {
        'packages': ['bar']
      });
      google.charts.setOnLoadCallback(drawAvgPriceChart);
    })
    drawAvgPriceChart = () => {
      var data = google.visualization.arrayToDataTable(avgPriceChartData);
      var options = {
        chart:{
            title: "Average Price of Coffee per Location",
        },
        axes: {
            x: {
              0: { side: 'top', label: 'Locations'} // Top x-axis.
            }
          },
        legend: {
          position: "none"
        },
      };
      var chart = new google.charts.Bar(document.getElementById('avgPriceChart'));
      chart.draw(data, options);
    }
    var photosPerLocationData;
    $.post('photoperlocchart', (res) => {
      photosPerLocationData = JSON.parse(res);
      google.charts.load('current', {
        'packages': ['corechart']
      });
      google.charts.setOnLoadCallback(drawPhotoPerLocChart);
    })
    drawPhotoPerLocChart = () => {
      var data = google.visualization.arrayToDataTable(photosPerLocationData);
      var options = {
        title: "Photos Per Location",
        is3D: true
      };
      var chart = new google.visualization.PieChart(document.getElementById('photoPerLocChart'));
      chart.draw(data, options);
    }
    var postsOverTimeChart;
    $.post('postsovertimechart', (res) => {
      postsOverTimeChart = JSON.parse(res);
      console.log(postsOverTimeChart)
      google.charts.load('current', {
        'packages': ['corechart']
      });
      google.charts.setOnLoadCallback(drawPostsOverTimeChart);
    })
    drawPostsOverTimeChart = () => {
      var data = google.visualization.arrayToDataTable(postsOverTimeChart);
      var options = {
          title : 'Posts created over time',
          vAxis: {title: 'Posts'},
          hAxis: {title: 'Date'},
          seriesType: 'bars',
          series: {1: {type: 'line'}}
        };
      var chart = new google.visualization.ComboChart(document.getElementById('postsOverTimeChart'));
      chart.draw(data, options);
    }
    var usersOverTimeChart;
    $.post('usersovertimechart', (res) => {
      usersOverTimeChart = JSON.parse(res);
      google.charts.load('current', {
        'packages': ['bar']
      });
      google.charts.setOnLoadCallback(drawUsersOverTimeChart);
    })
    drawUsersOverTimeChart = () => {
      var data = google.visualization.arrayToDataTable(usersOverTimeChart);
      var options = {
          title : 'Users registered over time',
          vAxis: {title: 'Users'},
          hAxis: {title: 'Date'},
          seriesType: 'bars',
          series: {1: {type: 'line'}}
        };
      var chart = new google.visualization.ComboChart(document.getElementById('usersOverTimeChart'));
      chart.draw(data, options);
    }
  </script>
</h:head>

<h:body>
    <ui:include src="/navbar.xhtml" />
      <h:panelGroup layout="block" class="jumbotron">
        <h:panelGroup layout="block" class="container">
          <h1>Website related Statistics</h1>
        </h:panelGroup>
      </h:panelGroup>
      <h:panelGroup layout="block" class="px-5">
        <h:panelGroup layout="block" class="row">
          <h:panelGroup layout="block" class="col-lg-3 col-md-6 col-sm-6">
            <div id="avgPriceChart" style="width: 100%; height: 100%;"></div>
          </h:panelGroup>
          <h:panelGroup layout="block" class="col-lg-3 col-md-6 col-sm-6">
              <div id="photoPerLocChart" style="width: 100%; height: 100%;"></div>
          </h:panelGroup>
          <h:panelGroup layout="block" class="col-lg-3 col-md-6 col-sm-6">
              <div id="postsOverTimeChart" style="width: 100%; height: 100%;"></div>
          </h:panelGroup>
          <h:panelGroup layout="block" class="col-lg-3 col-md-6 col-sm-6">
              <div id="usersOverTimeChart" style="width: 100%; height: 400px;"></div>
          </h:panelGroup>
      </h:panelGroup>
      </h:panelGroup>
  <c:choose>
    <c:when test="${currentUser.isLoggedIn}">
      
    </c:when>
    <c:otherwise>
      <ui:include src="403.xhtml" />
    </c:otherwise>
  </c:choose>
</h:body>

</html>